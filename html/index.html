<body>
    <table>
        <tbody>
            <tr>
                <!-- <th></th>
                <th></th>
                <th></th>
                <th class="close-window">
                    <button class="minimize-button"></button>
                    <button class="close-button"></button>
                </th> -->
            </tr>
            <tr class="titles">
                <th colspan="4">
                    <h1>Calculator</h1>
                </th>
            </tr>
            <tr>
                <th colspan="4">
                    <input class="action_window" type="text" min="0">
                </th>
            </tr>
            <tr>
                <th colspan="2">
                    <button onclick="eraseOnesymbol()">С</button>
                </th>
                <th colspan="1">
                    <button onclick="deleteAllsymbols()">DEL</button>
                </th>
                <th colspan="2">
                    <button onclick="clickhandlerNumber('/')">&divide</button>
                </th>
            </tr>
            <tr>
                <th colspan="1">
                    <button onclick="clickhandlerNumber(1)">1</button>
                </th>
                <th colspan="1">
                    <button onclick="clickhandlerNumber(2)">2</button>
                </th>
                <th colspan="1">
                    <button onclick="clickhandlerNumber(3)">3</button>
                </th>
                <th colspan="1">
                    <button onclick="clickhandlerNumber('*')">*</button>
                </th>
            </tr>
            <tr>
                <th><button onclick="clickhandlerNumber(4)">4</button></th>
                <th><button onclick="clickhandlerNumber(5)">5</button></th>
                <th>
                    <button onclick="clickhandlerNumber(6)">6</button>
                </th>
                <th><button onclick="clickhandlerNumber('+')">+</button></th>
            </tr>
            <tr>
                <th><button onclick="clickhandlerNumber(7)">7</button></th>
                <th><button onclick="clickhandlerNumber(8)">8</button></th>
                <th><button onclick="clickhandlerNumber(9)">9</button></th>
                <th>
                    <button onclick="clickhandlerNumber('-')">-</button>
                </th>
            </tr>
            <tr>
                <th><button onclick="clickhandlerNumber(0)">0</button></th>
                <th><button onclick="'.'">.</button></th>
                <th colspan="2">
                    <button class="equals" onclick="calculateExpression()">=</button>
                </th>
            </tr>
        </tbody>
    </table>
    <script>
        document.addEventListener('keydown', handleKeyPress);

        const actionWindow = window.document.querySelector('.action_window');
        const allowedKeys = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', 'ArrowLeft', 'ArrowRight',];
        const mathematicalOperators = ['-', '+', '/', '*']

        // сортировка лишних нажатий 
        const checkingClickRegistrations = (event) => {
            const button = event.key.toLowerCase();//тут я использую приведения к нижнему регистру

            console.log(button)
            if (button === 'backspace') {
                eraseOnesymbol();
            }
            if (button === 'delete') {
                deleteAllsymbols();
            }
            if (allowedKeys.includes(button) || mathematicalOperators.includes(button)) {
                actionWindow.value += button
            }
            if (button === 'enter') {
                calculateExpression()
            }
            if (button === '.') {
                actionWindow.value += '.'
            }
        };
        const checkExpressionDot = () => {
            console.log('.')
        };
        //        const checkExpression = () => {
        //        }

        //регистрация ввода символов в окно 
        actionWindow.addEventListener('keydown', (event) => {
            checkingClickRegistrations(event)
        });
        //регистрация нажатий с клавиатуры ! 
        function handleKeyPress(event) {
            checkingClickRegistrations(event)
        };
        const clickhandlerNumber = (num) => {
            actionWindow.value += num;
        };
        const deleteAllsymbols = () => {
            actionWindow.value = ''
        };
        const eraseOnesymbol = () => {
            actionWindow.value = actionWindow.value.slice(0, -1)
        };



        const calculateExpression = () => {
            let result
            const operatorPriority = {
                '+': 1,
                '-': 1,
                '*': 2,
                '/': 2,
            };
            const mathematicalExpression = (num1, num2, operator) => {
                if (operator === '+') {

                    return num1 + num2;
                }
                if (operator === '-') {
                    return num1 - num2;
                }
                if (operator === '/') {
                    return num1 / num2;
                }
                if (operator === '*') {
                    return num1 * num2;
                }
            }
            const expressions = actionWindow.value;
            //тут строку с выражения ми перевел в массив 
            const arrayExpressions = expressions.split(/([+\-*/])/).map((token) => token.trim());// заменить на свое ! регулярную переменную на массив
            // тут из строки нашел значения операторов 
            const operators = expressions.match(new RegExp(`[${mathematicalOperators.join('')}]`, 'g'));
            operators.sort((a, b) => operatorPriority[b] - operatorPriority[a]);

            while (operators.length !== 0) {
                let operator = operators.shift()
                let index = arrayExpressions.indexOf(operator)
                const num1 = arrayExpressions.splice(index - 1, 1)[0];
                const num2 = arrayExpressions.splice(index, 1)[0];
                index = arrayExpressions.indexOf(operator)
                console.log(typeof num1)
                console.log(typeof num2)
                arrayExpressions[index] = mathematicalExpression(+num1, +num2, operator)
            }
            console.log(`результат -${arrayExpressions}`)
            return actionWindow.value = arrayExpressions
        }

    </script>
    <!-- <script src="/data/index.js"></script> -->
</body>